<Project DefaultTargets="BuildAndPublish" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="CodegenCSPreBuild" 
            BeforeTargets="Build">
        <PropertyGroup>
            <CodegenCsExe>$(USERPROFILE)\.dotnet\tools\dotnet-codegencs.exe</CodegenCsExe>
            <CodegenOutputDir>$(MSBuildProjectDirectory)</CodegenOutputDir>
            <CodegenOutputDir Condition="$(CodegenOutputDir.EndsWith('\'))">$(CodegenOutputDir.TrimEnd('\'))</CodegenOutputDir>
        </PropertyGroup>

        <Error Condition="!Exists('$(CodegenCsExe)')" 
               Text="CodegenCS tool not found. Please install: dotnet tool install --global dotnet-codegencs" />

        <Message Importance="High" Text="Running CodegenCS for project: $(MSBuildProjectName)" />
        <Message Importance="High" Text="Output directory: $(CodegenOutputDir)" />

        <Exec Command="&quot;$(CodegenCsExe)&quot; template run &quot;$(MSBuildProjectDirectory)\User&quot; -r:System.Xml.dll -r:System.Xml.ReaderWriter.dll -r:System.Private.Xml.dll --OutputFolder &quot;$(CodegenOutputDir)&quot;" 
              WorkingDirectory="$(MSBuildProjectDirectory)" />
    </Target>

    <PropertyGroup>
        <ProjectFile>$(MSBuildProjectDirectory)\WebPsdzSdkClient.csproj</ProjectFile >
        <OutDir>$(MSBuildProjectDirectory)\..\Publish\</OutDir>
    </PropertyGroup>

    <Target Name="BuildAndPublish">
        <Message Importance="High" Text="Running BuildAndPublish" />
        <MSBuild Projects="$(ProjectFile)" Targets="Package" Properties="Configuration=Release;PackageLocation=$(OutDir)\MSDeploy\Package.zip;_PackageTempDir=$(OutDir)\Temp" />
    </Target>
</Project>
