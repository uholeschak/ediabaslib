<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="CodegenCSPreBuild" 
            BeforeTargets="Build">
        <PropertyGroup>
            <CodegenCsExe>$(USERPROFILE)\.dotnet\tools\dotnet-codegencs.exe</CodegenCsExe>
            <CodegenOutputDir>$(MSBuildProjectDirectory)</CodegenOutputDir>
            <CodegenOutputDir Condition="$(CodegenOutputDir.EndsWith('\'))">$(CodegenOutputDir.TrimEnd('\'))</CodegenOutputDir>
        </PropertyGroup>

        <Error Condition="!Exists('$(CodegenCsExe)')" 
               Text="CodegenCS tool not found. Please install: dotnet tool install --global dotnet-codegencs" />

        <Message Importance="High" Text="Running CodegenCS for project: $(MSBuildProjectName)" />
        <Message Importance="High" Text="Output directory: $(CodegenOutputDir)" />

        <Exec Command="&quot;$(CodegenCsExe)&quot; template run &quot;$(MSBuildProjectDirectory)\User&quot; -r:System.Xml.dll -r:System.Xml.ReaderWriter.dll -r:System.Private.Xml.dll --OutputFolder &quot;$(CodegenOutputDir)&quot;" 
              WorkingDirectory="$(MSBuildProjectDirectory)" />
    </Target>

    <PropertyGroup>
        <PublishDir>$(MSBuildProjectDirectory)\..\Publish\</PublishDir>
    </PropertyGroup>

    <!-- Package läuft automatisch nach erfolgreichem Build -->
    <Target Name="PackageAfterBuild"
            AfterTargets="Build"
            Condition="'$(Configuration)' == 'Release'">
        <Message Importance="High" Text="Creating package for $(MSBuildProjectName) to $(PublishDir)..." />
        <MSBuild Projects="$(MSBuildProjectFullPath)"
                 Targets="WebPublish"
                 Properties="WebPublishMethod=FileSystem;PublishUrl=$(PublishDir);DeleteExistingFiles=true" />
    </Target>
</Project>
